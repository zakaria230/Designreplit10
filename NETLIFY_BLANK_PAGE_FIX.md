# حل مشكلة الصفحة البيضاء في Netlify

إذا كنت تواجه مشكلة ظهور صفحة بيضاء فارغة بعد نشر التطبيق على Netlify، إليك الحلول:

## 1. استخدم أدوات التشخيص المضمنة

قمنا بإضافة أدوات تشخيصية يمكنك استخدامها للتحقق من المشكلة:

- **تشخيص الخادم**: قم بزيارة `https://your-site.netlify.app/diagnose` للحصول على معلومات عن الخادم وقاعدة البيانات
- **سجلات وحدة التحكم**: افتح وحدة تحكم المتصفح (F12) للتحقق من أي أخطاء

## 2. تحقق من الملفات الأساسية

تأكد من وجود الملفات الأساسية في المكان الصحيح:

```bash
# التحقق من index.html
curl -I https://your-site.netlify.app/index.html

# التحقق من ملف JavaScript الرئيسي
curl -I https://your-site.netlify.app/assets/index.js
```

## 3. حلول شائعة

### مشكلة 1: المسارات النسبية

تأكد من أن الروابط في index.html تستخدم المسارات المطلقة:

```html
<!-- ✓ صحيح -->
<script src="/assets/index.js"></script>

<!-- ✗ خطأ -->
<script src="assets/index.js"></script>
```

### مشكلة 2: المسار الأساسي (Base Path)

أضف وسم `<base>` لضمان تحميل الموارد بشكل صحيح:

```html
<head>
  <base href="/" />
  <!-- باقي العناصر -->
</head>
```

### مشكلة 3: إعدادات _redirects

تأكد من وجود ملف `_redirects` الصحيح في مجلد `dist/client`:

```
# Netlify redirects file
/api/*  /.netlify/functions/api/:splat  200
/*      /index.html                     200
```

### مشكلة 4: مشاكل CORS

قد تكون هناك مشاكل CORS تمنع API من العمل. أضف رؤوس CORS المناسبة:

```javascript
// في ملف api.js
app.use((req, res, next) => {
  res.setHeader('Access-Control-Allow-Origin', '*');
  // ... رؤوس CORS الأخرى
  next();
});
```

## 4. استخدام وظيفة الخادم البديلة

قمنا بإضافة وظيفة `server.js` التي يمكنها خدمة الملفات الثابتة مع تشخيصات إضافية. جرب الوصول إلى:

```
https://your-site.netlify.app/server/
```

## 5. إضافة سكريبت تشخيصي

أضف هذا السكريبت لتشخيص المشاكل تلقائيًا:

```html
<script src="/build-info.js"></script>
```

هذا السكريبت سيُظهر معلومات تشخيصية عندما تكون الصفحة فارغة.

## 6. الإجراءات النهائية

إذا استمرت المشكلة:

1. عدّل ملف `vite.config.ts` لضمان مسارات الأصول الصحيحة
2. تأكد من تعيين المتغيرات البيئية اللازمة في Netlify
3. جرّب استخدام أمر البناء المبسط `npm run build` دون سكريبت الإعداد اللاحق
4. تحقق من سجلات النشر في لوحة تحكم Netlify لمعرفة المزيد من التفاصيل

## 7. احتياجات التبعيات

تأكد من تثبيت الحزم التالية للوظائف التشخيصية:

```bash
npm install --save-dev mime-types
```