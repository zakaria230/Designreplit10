# دليل نشر تطبيق Desivoo على cPanel

هذا الدليل يشرح كيفية نشر تطبيق Desivoo (منصة التجارة الإلكترونية للتصميمات الرقمية) على استضافة cPanel.

## الملفات المطلوبة

1. **index.js**: الملف الرئيسي للخادم
2. **package.json**: ملف تعريف التطبيق والاعتمادات
3. **static**: مجلد يحتوي على ملفات الواجهة الأمامية (الملفات المُجمعة من dist/client)
4. **uploads**: مجلد يحتوي على الملفات المرفوعة (الصور، المنتجات، إلخ)

## خطوات النشر

### 1. تجهيز الملفات المطلوبة

1. **قم ببناء تطبيق الواجهة الأمامية**:
   ```bash
   npm run build
   ```
   
   هذا سينشئ مجلد `dist/client` الذي يحتوي على ملفات الواجهة الأمامية المُجمعة.

2. **أنشئ مجلد جديد لملفات النشر على جهازك**:
   ```bash
   mkdir desivoo-cpanel
   cd desivoo-cpanel
   ```

3. **اجمع الملفات التالية في هذا المجلد**:
   - انسخ ملف `index.js` المُحدث الذي أنشأناه
   - انسخ محتوى ملف `minimal-package.json` إلى ملف يسمى `package.json`
   - أنشئ مجلد يسمى `static`
   - أنشئ مجلد يسمى `uploads`

4. **انسخ محتويات مجلد dist/client إلى مجلد static**:
   ```bash
   cp -r /path/to/your/project/dist/client/* static/
   ```

5. **انسخ محتويات مجلد uploads الأصلي إلى مجلد uploads الجديد**:
   ```bash
   cp -r /path/to/your/project/uploads/* uploads/
   ```

### 2. تهيئة التطبيق على cPanel

1. **سجّل دخولك إلى لوحة تحكم cPanel**

2. **انتقل إلى قسم "Setup Node.js App"**

3. **قم بإنشاء تطبيق Node.js جديد (أو تعديل القائم) بالإعدادات التالية**:
   - **Node.js version**: 18.x
   - **Application mode**: Production
   - **Application root**: المسار الكامل لمجلد موقعك (مثل `/home/b5a4fc5/Desivoo`)
   - **Application URL**: اسم النطاق أو النطاق الفرعي المطلوب
   - **Application startup file**: `index.js`
   - **Passenger log file**: `/home/b5a4fc5/logs/passenger.log` (أو المسار المناسب)

### 3. رفع الملفات إلى cPanel

#### الطريقة الأولى: استخدام مدير الملفات

1. **انتقل إلى File Manager في cPanel**
2. **انتقل إلى المجلد الرئيسي لموقعك**
3. **ارفع جميع الملفات والمجلدات من مجلد `desivoo-cpanel` إلى هذا المجلد**

#### الطريقة الثانية: استخدام FTP

1. **استخدم برنامج FTP مثل FileZilla للاتصال بحسابك**
2. **انتقل إلى المجلد الرئيسي لموقعك**
3. **ارفع جميع الملفات والمجلدات من مجلد `desivoo-cpanel` إلى هذا المجلد**

### 4. تثبيت الاعتمادات على الخادم

1. **اتصل بالخادم عبر SSH أو Terminal في cPanel**
2. **انتقل إلى المجلد الرئيسي لموقعك**:
   ```bash
   cd ~/public_html
   ```
   أو المسار المناسب لموقعك.

3. **قم بتثبيت الاعتمادات المطلوبة**:
   ```bash
   npm install
   ```

### 5. إعداد متغيرات البيئة

1. **أنشئ ملف `.env` في مجلد موقعك**:
   ```bash
   touch .env
   ```

2. **قم بتعديل ملف `.env` وأضف المتغيرات اللازمة**:
   ```
   NODE_ENV=production
   SESSION_SECRET=your_secure_session_secret
   # أضف أي متغيرات أخرى مطلوبة
   ```

### 6. بدء تشغيل التطبيق

1. **انتقل إلى لوحة تحكم cPanel**
2. **انتقل إلى قسم "Setup Node.js App"**
3. **حدد تطبيقك واضغط على زر "Restart"**

## اختبار التطبيق

بعد اكتمال عملية النشر، يمكنك اختبار التطبيق بزيارة:

1. **الصفحة الرئيسية**: https://your-domain.com
2. **نقطة التشخيص**: https://your-domain.com/api/diagnose
3. **فحص صحة API**: https://your-domain.com/api/health

## استكشاف الأخطاء وإصلاحها

### مشكلة: التطبيق لا يعمل

1. **تحقق من سجلات الأخطاء**:
   ```bash
   cat ~/logs/passenger.log
   ```

2. **تأكد من تثبيت جميع الاعتمادات**:
   ```bash
   cd ~/public_html
   npm list
   ```

3. **تحقق من وجود ملف index.js**:
   ```bash
   ls -la index.js
   ```

4. **تحقق من صلاحيات الملفات**:
   ```bash
   chmod 755 index.js
   chmod -R 755 static uploads
   ```

### مشكلة: الصور أو الملفات المرفوعة لا تظهر

1. **تأكد من وجود مجلد uploads**:
   ```bash
   ls -la | grep uploads
   ```

2. **تأكد من صلاحيات المجلد**:
   ```bash
   chmod -R 755 uploads
   ```

3. **تحقق من المسارات في ملف index.js**

### مشكلة: خطأ في الاتصال بقاعدة البيانات

في الإصدار الحالي، نحن نستخدم قاعدة بيانات وهمية مُضمنة. إذا كنت بحاجة إلى استخدام قاعدة بيانات حقيقية، فستحتاج إلى تعديل ملف index.js وإضافة اتصال قاعدة البيانات.

## نصائح إضافية

1. **قم بإنشاء نسخ احتياطية دورية لمجلد uploads**
2. **استخدم HTTPS لتأمين موقعك**
3. **راقب استخدام الذاكرة والمعالج للتطبيق من لوحة تحكم cPanel**
4. **قم بتحديث التطبيق بانتظام لتحسين الأداء والأمان**